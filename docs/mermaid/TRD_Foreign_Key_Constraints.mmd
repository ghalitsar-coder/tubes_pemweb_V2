graph TD
    %% TRD - Foreign Key Constraints & Referential Integrity
    %% Detailed Database Relationship Diagram
    
    subgraph "User Management"
        USERS["<b>users</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ name (VARCHAR, NOT NULL)<br/>â”œâ”€ email (VARCHAR, UNIQUE, NOT NULL)<br/>â”œâ”€ role (VARCHAR, DEFAULT: 'team_member')<br/>â”œâ”€ password (VARCHAR, NOT NULL)<br/>â””â”€ timestamps"]
    end
    
    subgraph "Core Business Logic"
        PROJECTS["<b>projects</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ user_id (FK â†’ users.id)<br/>â”œâ”€ name (VARCHAR, NOT NULL)<br/>â”œâ”€ description (TEXT, NOT NULL)<br/>â”œâ”€ status (ENUM: not_started|in_progress|on_hold|completed)<br/>â”œâ”€ budget (DECIMAL 15,2, NULLABLE)<br/>â”œâ”€ progress (INT, DEFAULT: 0)<br/>â””â”€ timestamps"]
        
        TASKS["<b>tasks</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ project_id (FK â†’ projects.id)<br/>â”œâ”€ assigned_to (FK â†’ users.id, NULLABLE)<br/>â”œâ”€ title (VARCHAR, NOT NULL)<br/>â”œâ”€ description (TEXT, NOT NULL)<br/>â”œâ”€ task_type (ENUM: feature|bug|improvement)<br/>â”œâ”€ status (ENUM: todo|in_progress|on_hold|completed)<br/>â”œâ”€ priority (VARCHAR, DEFAULT: 'medium')<br/>â”œâ”€ due_date (DATE, NOT NULL)<br/>â””â”€ timestamps"]
    end
    
    subgraph "Comment System"
        PROJECT_COMMENTS["<b>project_comments</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ project_id (FK â†’ projects.id)<br/>â”œâ”€ user_id (FK â†’ users.id)<br/>â”œâ”€ parent_id (FK â†’ project_comments.id, NULLABLE)<br/>â”œâ”€ content (TEXT, NOT NULL)<br/>â”œâ”€ image_path (VARCHAR, NULLABLE)<br/>â””â”€ timestamps + soft_deletes"]
        
        TASK_COMMENTS["<b>task_comments</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ task_id (FK â†’ tasks.id)<br/>â”œâ”€ user_id (FK â†’ users.id)<br/>â”œâ”€ parent_id (FK â†’ task_comments.id, NULLABLE)<br/>â”œâ”€ content (TEXT, NOT NULL)<br/>â”œâ”€ image_path (VARCHAR, NULLABLE)<br/>â””â”€ timestamps + soft_deletes"]
        
        COMMENTS_LEGACY["<b>comments (legacy)</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ task_id (FK â†’ tasks.id)<br/>â”œâ”€ user_id (FK â†’ users.id)<br/>â”œâ”€ project_id (FK â†’ projects.id, NULLABLE)<br/>â”œâ”€ parent_id (FK â†’ comments.id, NULLABLE)<br/>â”œâ”€ content (TEXT, NOT NULL)<br/>â”œâ”€ commentable_type (VARCHAR, NULLABLE)<br/>â”œâ”€ commentable_id (BIGINT, NULLABLE)<br/>â””â”€ timestamps + soft_deletes"]
    end
    
    subgraph "File Management"
        TASK_ATTACHMENTS["<b>task_attachments</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ task_id (FK â†’ tasks.id)<br/>â”œâ”€ filename (VARCHAR, NOT NULL)<br/>â”œâ”€ path (VARCHAR, NOT NULL)<br/>â”œâ”€ public_id (VARCHAR, NULLABLE)<br/>â”œâ”€ type (VARCHAR, NOT NULL)<br/>â””â”€ timestamps"]
        
        TASK_ATTACHMENT_COMMENTS["<b>task_attachment_comments</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ task_attachment_id (FK â†’ task_attachments.id)<br/>â”œâ”€ user_id (FK â†’ users.id)<br/>â”œâ”€ content (TEXT, NOT NULL)<br/>â””â”€ timestamps"]
    end
    
    subgraph "Calendar Integration"
        CALENDAR_EVENTS["<b>calendar_events</b><br/>â”œâ”€ id (PK, BIGINT, AUTO_INCREMENT)<br/>â”œâ”€ user_id (FK â†’ users.id)<br/>â”œâ”€ project_id (FK â†’ projects.id, NULLABLE)<br/>â”œâ”€ task_id (FK â†’ tasks.id, NULLABLE)<br/>â”œâ”€ title (VARCHAR, NOT NULL)<br/>â”œâ”€ event_date (DATE, NOT NULL)<br/>â”œâ”€ event_type (ENUM: meeting|task_deadline|review|etc)<br/>â”œâ”€ status (ENUM: scheduled|completed|cancelled)<br/>â”œâ”€ priority (ENUM: low|medium|high)<br/>â””â”€ timestamps + soft_deletes"]
    end
    
    %% Foreign Key Constraints with Actions
    
    %% User Constraints (CASCADE DELETE)
    USERS ===|"ON DELETE CASCADE<br/>user_id"| PROJECTS
    USERS ===|"ON DELETE SET NULL<br/>assigned_to"| TASKS
    USERS ===|"ON DELETE CASCADE<br/>user_id"| PROJECT_COMMENTS
    USERS ===|"ON DELETE CASCADE<br/>user_id"| TASK_COMMENTS
    USERS ===|"ON DELETE CASCADE<br/>user_id"| COMMENTS_LEGACY
    USERS ===|"ON DELETE CASCADE<br/>user_id"| TASK_ATTACHMENT_COMMENTS
    USERS ===|"ON DELETE CASCADE<br/>user_id"| CALENDAR_EVENTS
    
    %% Project Constraints (CASCADE DELETE)
    PROJECTS ===|"ON DELETE CASCADE<br/>project_id"| TASKS
    PROJECTS ===|"ON DELETE CASCADE<br/>project_id"| PROJECT_COMMENTS
    PROJECTS ===|"ON DELETE CASCADE<br/>project_id"| COMMENTS_LEGACY
    PROJECTS ===|"ON DELETE CASCADE<br/>project_id"| CALENDAR_EVENTS
    
    %% Task Constraints (CASCADE DELETE)
    TASKS ===|"ON DELETE CASCADE<br/>task_id"| TASK_COMMENTS
    TASKS ===|"ON DELETE CASCADE<br/>task_id"| COMMENTS_LEGACY
    TASKS ===|"ON DELETE CASCADE<br/>task_id"| TASK_ATTACHMENTS
    TASKS ===|"ON DELETE CASCADE<br/>task_id"| CALENDAR_EVENTS
    
    %% Attachment Constraints (CASCADE DELETE)
    TASK_ATTACHMENTS ===|"ON DELETE CASCADE<br/>task_attachment_id"| TASK_ATTACHMENT_COMMENTS
    
    %% Self-Referencing Constraints (CASCADE DELETE)
    PROJECT_COMMENTS ===|"ON DELETE CASCADE<br/>parent_id"| PROJECT_COMMENTS
    TASK_COMMENTS ===|"ON DELETE CASCADE<br/>parent_id"| TASK_COMMENTS
    COMMENTS_LEGACY ===|"ON DELETE CASCADE<br/>parent_id"| COMMENTS_LEGACY
    
    %% Constraint Legend
    subgraph "Constraint Legend"
        LEGEND["<b>Foreign Key Actions:</b><br/>ğŸ—‘ï¸ CASCADE DELETE - Child records deleted when parent is deleted<br/>âŒ SET NULL - Foreign key set to NULL when parent is deleted<br/>ğŸ”’ RESTRICT - Prevents deletion if child records exist<br/>ğŸ”„ SELF-REF - Table references itself for hierarchical data"]
    end
    
    %% Database Indexes (Performance Optimization)
    subgraph "Key Indexes"
        INDEXES["<b>Database Indexes:</b><br/>ğŸ“Š projects(user_id) - User's projects lookup<br/>ğŸ“Š tasks(project_id) - Project's tasks lookup<br/>ğŸ“Š tasks(assigned_to) - User's assigned tasks<br/>ğŸ“Š comments(*_id, created_at) - Comments timeline<br/>ğŸ“Š calendar_events(event_date, user_id) - Calendar queries<br/>ğŸ“Š calendar_events(project_id, event_date) - Project events"]
    end
    
    %% Color Coding for Constraint Types
    classDef primaryEntity fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef dependentEntity fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef junctionEntity fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000
    classDef systemEntity fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef legendEntity fill:#fafafa,stroke:#616161,stroke-width:1px,color:#000
    
    class USERS primaryEntity
    class PROJECTS,TASKS dependentEntity
    class PROJECT_COMMENTS,TASK_COMMENTS,COMMENTS_LEGACY,TASK_ATTACHMENTS,TASK_ATTACHMENT_COMMENTS junctionEntity
    class CALENDAR_EVENTS systemEntity
    class LEGEND,INDEXES legendEntity
